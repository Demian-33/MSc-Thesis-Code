key_label2 <- shp$CVE_MUN
names(key_label2) <- shp$NOMGEO
LPI_urb <- 4564.97
LPI_rur <- 3296.92
LPEI_urb <- 2354.65
LPEI_rur <- 1800.55
## (1.1) Definir areas pequeñas ====
group <- as.numeric(region)
K <- length(unique(group))
## (1.2) Covariables categoricas (no ordenadas) a matriz diseño ====
for(i in 1:ncol(Xcat)){
Xcat[, i] <- as.factor(as.integer(Xcat[, i]))
}
tail(tibble(Xcat)) # ya todas son factor
Xcat <- model.matrix( ~ 0 + . , data=Xcat) # generar a matriz diseño
## (1.3) Remover combinaciones lineales y correlaciones ====
Xtmp <- cbind(Xcon, Xbin)
a <- caret::findLinearCombos(Xtmp)
Xtmp <- Xtmp[, -c(a$remove)]
b <- caret::findCorrelation(cov(Xtmp), verbose=T, exact=T, cutoff = 0.8)
Xtmp <- Xtmp[, -c(b)]
dim(Xtmp)
## (1.4) Componentes principales ====
# Eigen <- eigen(cov(Xcon))
# cumsum(Eigen$values) / ncol(Xcon) # 19: 90%, 26: 95%
# Xpc <- Xcon %*% Eigen$vectors[, 1:26]
# a <- caret::findLinearCombos(Xbin)$remove
# Xtmp <- cbind(Xpc, Xbin[, -a])
# (3* y 4*) Distribucion de 0's, 1's, 2's ====
# 0: urbano, 1: rural
tmp <- tibble(ym, contexto=Xide$rururb, region=muni[region])
tmp <- tmp %>% mutate(
ym_ord = case_when(
is.na(ym) ~ NA,
contexto==0 & ym < log(LPEI_urb) ~ 0,
contexto==1 & ym < log(LPEI_rur) ~ 0,
contexto==0 & ym > log(LPEI_urb) & ym < log(LPI_urb)  ~ 1,
contexto==1 & ym > log(LPEI_rur) & ym < log(LPI_rur)  ~ 1,
TRUE  ~ 2),
ym_bin = case_when(
ym_ord <= 1 ~ 1, # carencias
is.na(ym_ord) ~ NA,
TRUE ~ 0) # no carencias
)
#renglones: primer argumento: clasificacion
#columnas: segundo argumento: contexto
# hacer dos matrices de conteos
table(tmp$ym_bin)
table(tmp$ym_bin, tmp$contexto)
cm1 <- tibble(
Categoria = factor(c(0, 0, 1, 1)),
Contexto = factor(c(0, 1, 0, 1)),
n = c(1596, 443, 388, 110))
table(tmp$ym_ord, tmp$contexto)
cm2 <- tibble(
Categoria = factor(c(0, 0, 1, 1, 2, 2)),
Contexto = factor(c(0, 1, 0, 1, 0, 1)),
n = c(69, 13, 319, 97, 1596, 443))
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=11) +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=8, size.unit = 'cm') +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=8) +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=8, size.unit = 'pt') +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=8, size.unit = 'ss') +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=11, size.unit = 'pt') +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
ggsave(plot=g0, width=20, height=20, units='cm',
filename=r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\Documento-Tesis\Figuras\c-vi\CDMX\dist-probit.pdf)')
g1 <- ggplot(cm2, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
geom_text(aes(label = paste0(n), family = 'serif'), size=11, size.unit = 'pt') +
theme_minimal() +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g1)
ggsave(plot=g1, width=20, height=20, units='cm',
filename=r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\Documento-Tesis\Figuras\c-vi\CDMX\dist-probitord.pdf)')
# (2) Modelo log-normal ====
# 80-20: se calcula un grafico y metricas
# pronostico: se calcula grafico y metricas
# estimacion (todos los datos): cantidades posteriores
set.seed(1)
# T: estimacion, F: 80-20 (establecer prop=0.2) y pronostico
datos <- get_obs(censo=T)
## (2.1) Cargar el modelo con VB ====
load(r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\EntornosR\muestraVB-log-normal-sesgado-estimacion.RData)')
muestra_vb <- muestra_VB$summary(variables = c('rho', 'sigma', 'mu', 'b'), out_stan)
## (2.2) Cargar el modelo con HMC ====
load(r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\EntornosR\muestraHMC-log-normal-sesgado-estimacion.RData)')
muestra_hmc <- muestra_HMC$summary(variables = c('rho', 'sigma', 'mu', 'b'), c(out_stan, 'rhat'))
## (2.3) Estimaciones de los parametros (solo estimación y pronostico) ====
parametros <- c(
paste0('$\\rho_{', 1:K, '}$'),
paste0('$\\sigma^{2}$'),
# paste0('$\\mu_{', 1:K, '}$')
paste0('$\\mu$')
)
colnames(muestra_hmc) <- paste0(colnames(muestra_hmc), 2)
pred_out <- tibble(parametros,
muestra_vb[1:length(parametros), c(2, 6, 7)],
muestra_hmc[1:length(parametros), c(2, 6, 7, 8)])
nombre
g0 <- ggplot(cm1, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
theme_minimal() +
geom_text(aes(label = paste0(n), family = 'serif'), size=26, size.unit = 'pt') +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g0)
ggsave(plot=g0, width=20, height=20, units='cm',
filename=r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\Documento-Tesis\Figuras\c-vi\CDMX\dist-probit.pdf)')
g1 <- ggplot(cm2, aes(Contexto, Categoria, fill=n)) +
geom_tile(color='gray85', lwd=1.2) +
scale_x_discrete(limits = rev) +
scale_fill_gradient(low = "white", high = "gray75") +
geom_text(aes(label = paste0(n), family = 'serif'), size=26, size.unit = 'pt') +
theme_minimal() +
theme(text=element_text(family='serif', size=26), legend.position = 'none') +
labs(x=expression(Contexto),
y=expression(Clasificación),
fill=expression(n)) +
guides(fill = guide_colourbar(barwidth = 0.5,
labels=seq(0, 2000, by=500),
barheight = 20))
x11(); print(g1)
ggsave(plot=g1, width=20, height=20, units='cm',
filename=r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\Documento-Tesis\Figuras\c-vi\CDMX\dist-probitord.pdf)')
colnames(muestra_hmc) <- paste0(colnames(muestra_hmc), 2)
pred_out <- tibble(parametros,
muestra_vb[1:length(parametros), c(2, 6, 7)],
muestra_hmc[1:length(parametros), c(2, 6, 7, 8)])
## (2.7) Porcentaje de personas ====
## se promedian las muestras a posteriori exponenciadas
out <- which(is.na(ym))
out
fitted_vb <- apply(exp(muestra_VB$draws('y_all')), 2, mean)
fitted_hmc <- apply(exp(drop(muestra_HMC$draws('y_all'))), 2, mean)
dftmp <- tibble(AjustadosVB=fitted_vb[out],
AjustadosHMC=fitted_hmc[out],
Ámbito=Xide$rururb[out],
Factor=Xide$factor[out],
Tamaño=Xide$tam_hog[out],
Alcaldia=muni[region][out])
# tipo log normal
dftmp <- dftmp %>%
mutate(LPI_vb = case_when(
`Ámbito` == 0 & AjustadosVB < LPI_urb ~ 1L,
`Ámbito` == 1 & AjustadosVB < LPI_rur ~ 1L,
TRUE                                ~ 0L),
LPI_hmc = case_when(
`Ámbito` == 0 & AjustadosHMC < LPI_urb ~ 1L,
`Ámbito` == 1 & AjustadosHMC < LPI_rur ~ 1L,
TRUE                                ~ 0L)) %>%
mutate(LPEI_vb = case_when(
`Ámbito` == 0 & AjustadosVB < LPEI_urb ~ 1L,
`Ámbito` == 1 & AjustadosVB < LPEI_rur ~ 1L,
TRUE                                ~ 0L),
LPEI_hmc = case_when(
`Ámbito` == 0 & AjustadosHMC < LPEI_urb ~ 1L,
`Ámbito` == 1 & AjustadosHMC < LPEI_rur ~ 1L,
TRUE                                ~ 0L))
#
dftmp2 <- dftmp %>%
group_by(Alcaldia) %>%
summarise(Total = sum(Factor*Tamaño),
Total_LPI_vb = sum(Factor*LPI_vb*Tamaño), Total_LPEI_vb = sum(Factor*LPEI_vb*Tamaño),
Total_LPI_hmc = sum(Factor*LPI_hmc*Tamaño), Total_LPEI_hmc = sum(Factor*LPEI_hmc*Tamaño),
Porcentaje_LPI_vb = 100*Total_LPI_vb/Total, Porcentaje_LPEI_vb = 100*Total_LPEI_vb/Total,
Porcentaje_LPI_hmc = 100*Total_LPI_hmc/Total, Porcentaje_LPEI_hmc = 100*Total_LPEI_hmc/Total)
dftmp2 %>% select(Total, starts_with('Porcentaje'))
sum(dftmp2$Total_LPI_vb) / sum(dftmp2$Total) # 25.7 %
sum(dftmp2$Total_LPI_hmc) / sum(dftmp2$Total) # 25.7 %
sum(dftmp2$Total_LPEI_vb) / sum(dftmp2$Total) # 25.7 %
sum(dftmp2$Total_LPEI_hmc) / sum(dftmp2$Total) # 25.7 %
# ordenar de acuerdo a muni
dftmp2 <- dftmp2[match(muni, dftmp2$Alcaldia), ]
personas <- dftmp2 %>% select(Alcaldia, starts_with('Porcentaje') & ends_with('vb'))
personas <- dftmp2 %>% select(Alcaldia, starts_with('Porcentaje'))
personas
## (2.8) Mapas ====
orden <- match(dftmp2$Alcaldia, shp$NOMGEO) # el elemento i (i=1, 2, ...) de #1 esta en la posición indicada de #2
orden2 <- match(muni, shp$NOMGEO) # el elemento i (i=1, 2, ...) de #1 esta en la posición indicada de #2
shp$LPI_vb_porcentaje[orden] <- dftmp2$Porcentaje_LPI_vb
shp$LPEI_vb_porcentaje[orden] <- dftmp2$Porcentaje_LPEI_vb
shp$LPI_hmc_porcentaje[orden] <- dftmp2$Porcentaje_LPI_hmc
shp$LPEI_hmc_porcentaje[orden] <- dftmp2$Porcentaje_LPEI_hmc
pal <- scales::grey_pal(start=0, end=0.11)(16)
names(pal) <- shp$NOMGEO
key_label <- shp$NOMGEO
names(key_label) <- shp$CVE_MUN
key_label2 <- shp$CVE_MUN
names(key_label2) <- shp$NOMGEO
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=20),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=20),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
g2 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPEI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPEI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
g3 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_hmc_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
g4 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPEI_hmc_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPEI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g4)
# 17.53
nombre <- file.path(fsep='\\', r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\Documento-Tesis\Figuras\c-vi\CDMX)',
'log-normal-sesgado-')
ggsave(plot=g1, filename=paste0(nombre, 'mapavb-lpi.pdf'), width=20, height = 20, units='cm')
ggsave(plot=g2, filename=paste0(nombre, 'mapavb-lpei.pdf'), width=20, height = 20, units='cm')
ggsave(plot=g3, filename=paste0(nombre, 'mapahmc-lpi.pdf'), width=20, height = 20, units='cm')
ggsave(plot=g4, filename=paste0(nombre, 'mapahmc-lpei.pdf'), width=20, height = 20, units='cm')
x11(); print(g1)
30/25
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(-3, 0, 0, 0, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, -3, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, -2, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, -1, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
x11(); print(g1)
g1 <- ggplot() +
annotation_map_tile(type = carto_lightnl_url, zoomin = 0, alpha = 0.8, progress = "none") +
geom_sf(data = shp, aes(fill= LPI_vb_porcentaje)) +
geom_sf_label(data=shp, aes(label = CVE_MUN, colour=NOMGEO, family='serif'), size = 4,  key_glyph = "cust") +
scale_colour_manual(name="Alcaldías", values = pal, limits=key_label) +
annotation_scale(location = "bl", width_hint = 0.4, text_family='serif') +
annotation_north_arrow(location = "tl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(9, "Greys")) +
scale_fill_gradient(low = "gray100", high = "gray50", limits=c(0, 50), breaks = seq(0, 50, by = 10)) +
labs(fill ='Población bajo\nLPI (%)', title = "", x='', y='') +
theme(
plot.margin = margin(0, 0, 0, -1, "cm"),
text = element_text(family = "serif", size=26),
legend.position = 'right',
panel.border = element_rect(color = "black", fill = NA, linewidth = 1))
20*1.2
ggsave(plot=g1, filename=paste0(nombre, 'mapavb-lpi.pdf'), width=24, height = 20, units='cm')
# 17.53
nombre <- file.path(fsep='\\', r'(C:\Maestría_CP\Tesis\Documento-Tesis-SAOM\Documento-Tesis\Figuras\c-vi\CDMX)',
'log-normal-sesgado-')
ggsave(plot=g1, filename=paste0(nombre, 'mapavb-lpi.pdf'), width=24, height = 20, units='cm')
ggsave(plot=g2, filename=paste0(nombre, 'mapavb-lpei.pdf'), width=24, height = 20, units='cm')
ggsave(plot=g3, filename=paste0(nombre, 'mapahmc-lpi.pdf'), width=24, height = 20, units='cm')
ggsave(plot=g4, filename=paste0(nombre, 'mapahmc-lpei.pdf'), width=24, height = 20, units='cm')
